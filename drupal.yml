---
- name: Drupal | Get the latest stable version(7)
  git:
    repo: "https://github.com/drupal/drupal.git"
    version: "7.56"
    dest: "{{ drupal_docroot }}"

# - name: Drupal | Get the source code from git

# - name: Drupal | Restore if there is a DB snapsot

- name: Drupal | Check if site is already installed
  command: >
    drush status --root={{ drupal_docroot }} | grep -i 'drupal bootstrap'
  register: drush_status

- debug:
    var: drush_status
    
- name: Drupal | Drush site install if DB snapshot is absent
  command: >
    drush site-install standard -y
    --site-name="{{ drupal_site_name }}"
    --account-name={{ drupal_account_name }}
    --account-pass={{ drupal_account_pass }}
    --db-url=mysql://{{ drupal_db.user }}:{{ drupal_db.password }}@localhost/{{ drupal_db.name }}
    -r {{ drupal_docroot }}

# - name: Drupal | Run updates
